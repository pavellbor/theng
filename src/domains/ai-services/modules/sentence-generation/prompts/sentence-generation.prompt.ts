import { GenerateSentenceParams } from '../interfaces/generate-sentence-params.interface';
import { PromptTemplate } from '../interfaces/prompt-template.interface';

export const sentenceGenerationPrompt: PromptTemplate<GenerateSentenceParams> =
  {
    version: '1.1.0',
    template: `Твоя задача — создать одно образцовое учебное предложение для изучающих английский язык. Ты — опытный методист и лингвист, специализирующийся на создании естественно звучащих, аутентичных и полезных примеров.

**ОСНОВНЫЕ ПАРАМЕТРЫ ЗАДАНИЯ:**
- Слово для включения в предложение: "{{word}}" (часть речи: {{partOfSpeech}}, перевод: {{russianTranslation}})
- Грамматическая тема для демонстрации: "{{grammarTopic}}"
- Уровень сложности по CEFR: {{cefrLevel}}

**ТРЕБОВАНИЯ К АНГЛИЙСКОМУ ПРЕДЛОЖЕНИЮ:**

1. **ЕСТЕСТВЕННОСТЬ И АУТЕНТИЧНОСТЬ** (критически важно)
   - Предложение должно звучать как естественная разговорная или письменная речь, а НЕ как искусственный учебный пример
   - Должно отражать реальное современное употребление английского языка
   - Избегай архаичных оборотов, слишком формальных конструкций или нереалистичных ситуаций

2. **ДЕМОНСТРАЦИЯ ГРАММАТИЧЕСКОЙ ТЕМЫ "{{grammarTopic}}"**
   - Грамматическая тема должна быть интегрирована естественно, как часть смысла предложения
   - Не делай грамматическую структуру слишком очевидной или "учебной"
   - Демонстрируй применение правила в живом, реальном контексте

3. **ИСПОЛЬЗОВАНИЕ КЛЮЧЕВОГО СЛОВА "{{word}}"**
   - Правильно используй слово в соответствии с частью речи ({{partOfSpeech}})
   - Покажи типичное, естественное употребление слова в контексте
   - Предложение должно отражать значение слова ({{russianTranslation}})

4. **СООТВЕТСТВИЕ УРОВНЮ {{cefrLevel}}**
   - Лексика и структура должны соответствовать указанному уровню CEFR
   - Для A1-A2: простые, короткие предложения (5-8 слов) с базовой лексикой
   - Для B1-B2: предложения средней сложности (8-12 слов) с более разнообразной лексикой
   - Для C1-C2: допустимы более сложные структуры, но сохраняй ясность и естественность

5. **ПРАКТИЧЕСКАЯ ЦЕННОСТЬ**
   - Предложение должно быть полезным для повседневного общения
   - Содержание должно быть релевантным для типичных коммуникативных ситуаций
   - Избегай слишком специализированных, необычных или непрактичных примеров

**ТРЕБОВАНИЯ К РУССКОМУ ПЕРЕВОДУ:**

1. **ЕСТЕСТВЕННОСТЬ РУССКОГО ЯЗЫКА**
   - Перевод должен звучать как естественная русская речь, а не переведенный текст
   - Используй идиоматические выражения русского языка, где это уместно
   - Фокусируйся на передаче смысла, а не на дословном переводе

2. **ТОЧНОСТЬ И ЭКВИВАЛЕНТНОСТЬ**
   - Перевод должен точно передавать смысл оригинала и грамматическое время
   - При необходимости адаптируй перевод для передачи культурных нюансов
   - Сохраняй эмоциональную окраску и регистр оригинала

3. **ЗАПРЕТ НА ИЗБЫТОЧНЫЕ СКОБКИ И ПОЯСНЕНИЯ**
   - Категорически избегай скобок в переводе — это делает текст неестественным
   - Не добавляй слово "(я)" в начале предложений, где это подразумевается глаголом
   - Не используй скобки для пояснений или альтернативных переводов

**ПРИМЕРЫ ПО УРОВНЯМ CEFR:**

**Для уровня A1:**
- Слово: "like" (глагол, "нравиться")
- Грамм. тема: "Present Simple"
- ✅ ХОРОШО: "I like pizza for dinner." → "Я люблю пиццу на ужин."
- ❌ ПЛОХО: "I like participating in various intellectual activities." (слишком сложно для A1)

**Для уровня B1:**
- Слово: "probably" (наречие, "вероятно")
- Грамм. тема: "Future Simple"
- ✅ ХОРОШО: "We will probably visit my parents this weekend." → "Мы, вероятно, навестим моих родителей в эти выходные."
- ❌ ПЛОХО: "We probably will visit my parents." (неестественный порядок слов)

**Для уровня C1:**
- Слово: "consider" (глагол, "рассматривать, считать")
- Грамм. тема: "Present Perfect Continuous"
- ✅ ХОРОШО: "I have been considering a career change for the past few months." → "Последние несколько месяцев я раздумываю о смене карьеры."
- ❌ ПЛОХО: "I have been considering." (незаконченная мысль)

**ОТВЕТ ДОЛЖЕН СОДЕРЖАТЬ ТОЛЬКО JSON В СЛЕДУЮЩЕМ ФОРМАТЕ:**
\`\`\`json
{
  "englishSentence": "Одно естественное, аутентичное английское предложение с использованием заданного слова и грамматической темы",
  "russianTranslation": "Естественный, идиоматически правильный перевод на русский язык БЕЗ каких-либо скобок"
}
\`\`\`

Создай одно безупречное предложение соответствующее всем требованиям — естественное, практичное, демонстрирующее грамматику "{{grammarTopic}}", использующее слово "{{word}}" и подходящее для уровня {{cefrLevel}}.`,

    render: (params: GenerateSentenceParams): string => {
      let result = sentenceGenerationPrompt.template;

      Object.entries(params).forEach(([key, value]) => {
        result = result.replace(new RegExp(`{{${key}}}`, 'g'), value);
      });

      return result;
    },
  };
